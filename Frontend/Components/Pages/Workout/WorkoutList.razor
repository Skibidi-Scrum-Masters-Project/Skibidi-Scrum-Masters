@page "/workouts"
@using Microsoft.AspNetCore.Components
@using FitLifeFitness.Components.Layout
@using FitLifeFitness.Models
@layout EmptyLayout

<div class="workout-screen">

    <h2 class="workout-title">Træningsprogrammer</h2>
    <p class="workout-subtitle">Vælg et program for at se øvelser</p>

    <div class="workout-grid">
        @foreach (var workout in Workouts)
        {
            <button class="workout-card" @onclick="() => OpenWorkout(workout.Id)">
                <div class="workout-card-header">
                    <h3>@workout.Name</h3>
                    
                </div>

                <p class="workout-focus">@workout.Description</p>

                <p class="workout-meta">
                    @workout.ExerciseTypes.Count øvelser 
                </p>
            </button>
        }
    </div>
</div>

@code {
    [Inject] private NavigationManager Nav { get; set; } = default!;

    [Inject] private FitLifeFitness.Services.SoloTrainingService SoloTrainingService { get; set; } = default!;
    private List<WorkoutProgramDTO> Workouts { get; set; } = new List<WorkoutProgramDTO>();
    protected override async Task OnInitializedAsync()
    {
        var response = await SoloTrainingService.GetWorkoutPrograms();
        if (response.IsSuccessStatusCode)
        {
            List<WorkoutProgramDTO>? programs = await response.Content.ReadFromJsonAsync<List<WorkoutProgramDTO>>();
            if (programs != null)
            {
                Workouts = programs.Select(p => new WorkoutProgramDTO
                {
                    Id = p.Id!,
                    Name = p.Name,
                    Description = p.Description,
                    ExerciseTypes = p.ExerciseTypes,
                }).ToList();
            }
        }
    }
    private void OpenWorkout(string id)
    {
        Nav.NavigateTo($"/workouts/{id}");
    }

    public class WorkoutModel
    {
        public string Id { get; set; } = "";
        public string Name { get; set; } = "";
        public string Level { get; set; } = "";
        public string Focus { get; set; } = "";
        public int ExerciseCount { get; set; }
        public int EstimatedMinutes { get; set; }
    }
}