@page "/friends/{FriendId}"
@using FitLifeFitness.Components.Layout
@layout PhoneLayout
@inject NavigationManager Nav

<div class="fd">

    <header class="fd-head">
        <button class="back" @onclick="GoBack">‹</button>
        <div class="fd-head-text">
            <div class="fd-title">Ven</div>
            <div class="fd-sub">Profil</div>
        </div>
        <div class="spacer"></div>
    </header>

    @if (Friend == null)
    {
        <section class="fd-card">
            <div class="empty">Vennen kunne ikke findes</div>
            <button class="primary" @onclick="GoBack">Tilbage</button>
        </section>
    }
    else
    {
        <section class="fd-hero">
            <div class="fd-avatar">@Initials(Friend.Name)</div>

            <div class="fd-hero-text">
                <div class="fd-name">@Friend.Name</div>
                <div class="fd-meta">@Friend.City</div>

                @if (Friend.IsCoach)
                {
                    <div class="tag tag-coach">Coach</div>
                }
                else
                {
                    <div class="tag tag-member">Medlem</div>
                }
            </div>
        </section>

        <section class="fd-card">
            <div class="card-title">Hold vi går på sammen</div>

            @foreach (var c in SharedClasses)
            {
                <div class="row">
                    <div class="row-title">@c.Title</div>
                    <div class="row-meta">@c.Day · @c.Time</div>
                </div>
            }

            @if (!SharedClasses.Any())
            {
                <div class="empty">Ingen fælles hold</div>
            }
        </section>

        <section class="fd-card">
            <div class="card-title">Aftaler sammen</div>

            @foreach (var a in SharedAppointments)
            {
                <div class="row">
                    <div class="row-title">@a.Title</div>
                    <div class="row-meta">@a.Date · @a.Location</div>
                </div>
            }

            @if (!SharedAppointments.Any())
            {
                <div class="empty">Ingen fælles aftaler</div>
            }
        </section>

        <section class="fd-card">
            <div class="card-title">Handlinger</div>

            <button class="row-btn">
                Invitér til hold
                <span class="chev">›</span>
            </button>

            <button class="row-btn danger">
                Fjern ven
                <span class="chev">›</span>
            </button>

            <div class="note">
                TODO: Kobl handlinger på backend
            </div>
        </section>
    }

</div>

@code {
    [Parameter] public string FriendId { get; set; } = "";

    private FriendModel? Friend;

    protected override void OnParametersSet()
    {
        Friend = FriendsSeed.FirstOrDefault(x => x.Id == FriendId);
    }

    private void GoBack() => Nav.NavigateTo("/friends");

    private static string Initials(string name) =>
        string.Join("", name.Split(" ", StringSplitOptions.RemoveEmptyEntries).Select(x => x[0])).ToUpper();

    private List<FriendModel> FriendsSeed = new()
    {
        new() { Id = "f1", Name = "Sara Jensen", City = "Aarhus", IsCoach = false },
        new() { Id = "f2", Name = "Mikkel Holm", City = "Aalborg", IsCoach = false },
        new() { Id = "f3", Name = "Nanna Larsen", City = "Aarhus", IsCoach = true }
    };

    private List<ClassModel> SharedClasses = new()
    {
        new() { Title = "Pilates", Day = "Tirsdag", Time = "17:00" },
        new() { Title = "HIIT", Day = "Torsdag", Time = "18:30" }
    };

    private List<AppointmentModel> SharedAppointments = new()
    {
        new() { Title = "Morgen træning", Date = "12. marts", Location = "Fitness sal 1" },
        new() { Title = "Stræk & mobilitet", Date = "20. marts", Location = "Studio 2" }
    };

    private class FriendModel
    {
        public string Id { get; set; } = "";
        public string Name { get; set; } = "";
        public string City { get; set; } = "";
        public bool IsCoach { get; set; }
    }

    private class ClassModel
    {
        public string Title { get; set; } = "";
        public string Day { get; set; } = "";
        public string Time { get; set; } = "";
    }

    private class AppointmentModel
    {
        public string Title { get; set; } = "";
        public string Date { get; set; } = "";
        public string Location { get; set; } = "";
    }
}
